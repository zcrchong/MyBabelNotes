# Babel的编译流程
## 编译和转译
编译：从一种编程语言转成另外一种编程语言，主要是从高级语言到低级语言。比如从js转为汇编语言
### 那什么是高级语言，什么是低级语言呢？
高级语言就是有很多用于描述逻辑的语言特性，可以让开发者快速通过它来表达各种逻辑， 比如js、c++


低级语言就是更贴近于硬件和执行细节的语言，它可以操作寄存器、内存，比如汇编语言、机器语言


转译：对于从一种高级语言转为另一种高级语言的转换工具，被叫做转换编译器
Babel就是一个典型的转译器

## babel的编译流程
主要分为三步，总结来说就是由 source to source
流程主要为： 

parse -> transform -> generate
1. Parse: 通过 parse把源码转为抽象语法树(AST)
2. Transform: 遍历AST，调用各种tranform插件对AST进行增删改，总结来说就是由一种AST转换为另一种AST
3. generate：把转换后的AST打印成目标代码，并且生成sourcemap

## 那么为什么会分成这三步呢？
### 为何会parse？
源码是一串按照语法格式来组织的字符串，我们可能会认识源码的逻辑，但计算机并不认识，所以我们需要让计算机也认识源码到底干了什么。

所以我们要将源码转为一种计算机能够识别的数据结构，通过不同的对象来保存不同的数据。并且按照依赖关系组织起来，这种数据结构就是抽象语法树AST。
之所以叫“抽象”语法树就是因为数据结构中省略了一些无具体意义的分隔符，比如```；``` ```{ }```等
所以编译器第一步就要将源码转为（parse）AST。
### 为什么会transform？
因为编译的最终目的是将代码进行转换，而如何转换呢？

转成AST之后就可以通过修改AST的方式来修改代码。

即：通过遍历AST并进行各种增删改，通过修改AST，变相的来转换代码。
transform是Babel中最为核心的一步
### 为什么会generate？
转换抽象语法树之后并不能直接应用，之后我们就要再讲AST转为字符串（最终代码），这一步主要做的内容就是把第一步中删除的一些分隔符再加回来

总结：为了让计算机理解代码需要先对源码字符串进行parse，生成AST，通过AST增删改进行变相的修改代码，转换完AST之后再打印成目标代码字符串
## 这三步具体都做了什么？
### Parse
在上文中我们可以知道，parse的目的就是把源码字符串转为机器能够认识的AST，这一个过程转换的过程又具体分为词法分析和语法分析


比如：
```var a = 'zcr';```
这样一段源码，我们首先要将他分成一个个不能再继续分解的单词（也被称为token），也就是分为```var```  ,```a```,```=```,```'zcr'```,这个过程就是词法分析


之后就要把上述token进行递归的组装，生成AST，这个过程就是语法分析，即按照不同的语法结构来把一组单词合成对象，比如声明语句let、赋值表达式等都有对应的AST节点
### Transform
transform阶段就是对刚才上面生成的AST进行处理，首先会进行AST的遍历，在遍历的过程中处理到不同的AST节点会调用注册的相应的```visitor```函数，在这个```visitor```函数中可以对AST节点进行增删改，返回新的AST，这样遍历完成一遍AST之后就完成了对代码的修改
### Generate
在上面我们讲到了，generate阶段会把转换完成的AST打印成目标代码字符串，并且会生成sourceMap（源代码映射），

每个AST节点都会有不同的打印逻辑，比如```IfStatement```节点就可以打印成```if(xxx){}```格式的代码，之后将AST根节点进行递归的字符串拼接，从而生成目标代码的字符串
## 而什么是sourcemap呢？为什么要生成它呢？
sourcemap记录了源码和这一步generate后生成的目标代码的转换关系（对应关系），通过它我们可以找到目标代码中每一个节点对应的源码位置，用于调试的时候把编译后的代码映射为源码，或者线上报错的时候把报错位置映射到源码。


比如webpack中的sourcemap选项其实就是类似的功能，我们在开发环境下通常会开启它来定位到我们自己写的源码（压缩混淆后的代码几乎没有排查报错的能力..）

## 本节章末
恭喜你，如果你看到这里，可以说你对Babel可以算是入门了，在面试时至少有信心说“了解”Babel了，将以上内容总结成自己的内容，形成一个笼统的体系，应该可以对面试官侃侃而谈（吹牛）5-10分钟的样子，在babel这方面至少不会是减分项。
